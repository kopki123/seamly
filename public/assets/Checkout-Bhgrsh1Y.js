import{e as C,d as k,f as p,j as x,F as j,k as B,L as U,M as O,m as e,u as i,H as q,s as $,t as u,N as L,r as V,x as w,a as P,g as F,i as y,q as E,l as a}from"./index-FraBQ2Kp.js";import{u as G}from"./orders-CebBmeo1.js";import{u as R}from"./cart-BsFhFb_R.js";import{_ as H,n as z,b as A,F as b,a as I}from"./Input.vue_vue_type_script_setup_true_lang-CL-ZSAJR.js";import{T as M}from"./TextButton-CfOdV5Zv.js";import{D as _}from"./Divider-mqfohFcq.js";import{u as S}from"./index-x7-wbyOs.js";import{p as T,a as D,d as J}from"./checkoutConfig-iYPCOLar.js";import{u as K}from"./index-DZ5lCXHw.js";const Q={class:"radio"},W=["name","id","value","disabled","checked"],X=["for"],N=C({__name:"Radio",props:{modelValue:{},options:{},onChange:{type:Function,default:void 0}},emits:["update:modelValue"],setup(v,{emit:l}){const o=v,h=l,m=String(Date.now()),r=k({get(){return o.modelValue},set(t){h("update:modelValue",t)}});return(t,c)=>(p(),x("div",Q,[(p(!0),x(j,null,B(t.options,d=>(p(),x("div",{key:d.value,class:"my-2"},[U(e("input",{"onUpdate:modelValue":c[0]||(c[0]=g=>r.value=g),type:"radio",name:i(m),id:`${String(d.value)}-${i(m)}`,value:d.value,disabled:d==null?void 0:d.disabled,checked:d.value===r.value,onChange:c[1]||(c[1]=g=>{var f;return(f=t.onChange)==null?void 0:f.call(t,r.value)})},null,40,W),[[O,r.value]]),e("label",{for:`${String(d.value)}-${i(m)}`,class:"h-full ml-2 [&>*]:pointer-events-none"},[q(t.$slots,"option",L({ref_for:!0},d),()=>[$(u(d.label),1)])],8,X)]))),128))]))}}),Y={class:"w-full px-4 py-2 rounded-xl shadow-md flex flex-col gap-4 sm:flex-row sm:justify-between sm:items-end"},Z={class:"flex gap-3"},ee=["src"],te={class:"flex flex-col gap-2"},se=["textContent"],ae=["textContent"],le={class:"w-2/3 flex justify-between items-baseline"},oe={class:"text-xs sm:text-md text-primary-dark"},re=["textContent"],ne=["textContent"],de={class:"text-xs sm:text-md text-primary-dark"},ue=["textContent"],ie=C({__name:"CheckoutCartItem",props:{cartItem:{}},setup(v){return(l,o)=>(p(),x("div",Y,[e("div",Z,[e("img",{src:l.cartItem.product.image,alt:"",class:"w-16 h-16 object-cover rounded-xl overflow-hidden"},null,8,ee),e("div",te,[e("p",{textContent:u(l.cartItem.product.title),class:"text-lg"},null,8,se),e("p",{textContent:u(l.cartItem.product.description),class:"text-xs"},null,8,ae)])]),e("div",le,[e("p",oe,[o[0]||(o[0]=$(" NT. ")),e("span",{textContent:u(l.cartItem.product.price),class:"text-lg sm:text-2xl"},null,8,re)]),e("p",{textContent:u(`數量 : ${l.cartItem.quantity}`),class:"text-sm sm:text-xl"},null,8,ne),e("p",de,[o[1]||(o[1]=$(" NT. ")),e("span",{textContent:u(l.cartItem.product.price*l.cartItem.quantity),class:"text-lg sm:text-2xl"},null,8,ue)])])]))}}),me={class:"text-right pr-5"},pe={class:"text-right"},ce={class:"text-right"},fe={class:"text-right"},xe=C({__name:"CheckoutDetail",props:{deliveryFee:{}},setup(v){const l=v,o=R(),h=k(()=>l.deliveryFee+o.cartTotal);return(m,r)=>(p(),x("table",null,[e("tbody",null,[e("tr",null,[e("td",me,u(i(o).numItemsInCart)+"件商品，商品金額： ",1),e("td",pe,"$ "+u(i(o).cartTotal),1)]),e("tr",null,[r[0]||(r[0]=e("td",{class:"text-right pr-5"},"運費： ",-1)),e("td",ce,"$ "+u(m.deliveryFee),1)]),e("tr",null,[r[1]||(r[1]=e("td",{class:"text-right pr-5"},"應付金額： ",-1)),e("td",fe,"$ "+u(h.value),1)])])]))}}),ve={class:"w-full self-end flex justify-end gap-3"},we=C({__name:"Checkout",setup(v){const l=E(),o=R(),h=G(),m=V(),r=V(!1),t=w({payMethod:T[0].value,pickMethod:D[0].value,name:"",phone:""}),c=k(()=>J[t.pickMethod]),d=w({name:[{pattern:z,message:"請填寫取貨人資訊"}],phone:[{pattern:A,message:"取貨人手機號碼格式錯誤"}]});async function g(){if(r.value=!0,!m.value.validate()){r.value=!1;return}const{destroy:s}=S(),n=await h.createOrder({...t,deliveryFee:c.value});if(r.value=!1,s(),n.status==="error"){K({message:"建立訂單失敗",type:"error"});return}l.push({name:"order",params:{id:n.data.order.id}})}return P(async()=>{if(o.cartItems.length)return;const{destroy:f}=S(),s=await o.getCart();f(),(s.status==="error"||!o.cartItems.length)&&l.push({name:"home"})}),(f,s)=>(p(),F(H,{ref_key:"ruleFormRef",ref:m,model:t,rules:d,onSubmit:g,class:"mx-auto flex flex-col items-center md:w-4/5"},{default:y(()=>[s[5]||(s[5]=e("h1",{textContent:"訂單詳情",class:"text-xl font-bold text-center"},null,-1)),a(_,{class:"my-5"}),a(b,{label:"選擇付款方式",prop:"payMethod"},{default:y(()=>[a(N,{modelValue:t.payMethod,"onUpdate:modelValue":s[0]||(s[0]=n=>t.payMethod=n),options:i(T)},null,8,["modelValue","options"])]),_:1}),a(_,{class:"mb-5"}),a(b,{label:"選擇取貨方式",prop:"pickMethod"},{default:y(()=>[a(N,{modelValue:t.pickMethod,"onUpdate:modelValue":s[1]||(s[1]=n=>t.pickMethod=n),options:i(D)},null,8,["modelValue","options"])]),_:1}),a(_,{class:"mb-5"}),a(b,{label:"取貨人姓名",prop:"name"},{default:y(()=>[a(I,{modelValue:t.name,"onUpdate:modelValue":s[2]||(s[2]=n=>t.name=n)},null,8,["modelValue"])]),_:1}),a(b,{label:"取貨人手機號碼",prop:"phone"},{default:y(()=>[a(I,{modelValue:t.phone,"onUpdate:modelValue":s[3]||(s[3]=n=>t.phone=n)},null,8,["modelValue"])]),_:1}),a(_,{class:"my-5"}),(p(!0),x(j,null,B(i(o).cartItems,n=>(p(),F(ie,{key:n.id,cartItem:n},null,8,["cartItem"]))),128)),a(_,{class:"my-5"}),a(xe,{class:"self-end",deliveryFee:c.value},null,8,["deliveryFee"]),e("div",ve,[a(M,{text:"返回購物車",class:"!w-72 my-4 border-black",onClick:s[4]||(s[4]=n=>i(l).push({name:"CartContent"}))}),a(M,{text:"結帳",type:"submit",disabled:r.value,class:"!w-72 my-4 bg-primary-dark"},null,8,["disabled"])])]),_:1},8,["model","rules"]))}});export{we as default};
