import{i as k,g as $,o as p,c as x,F as N,l as R,t as q,P as L,a as e,u as i,M as A,B as C,x as u,Q as E,G as U,r as M,z as w,d as G,j as F,k as y,A as z,n as H,m as a}from"./index-COMXhcBS.js";import{u as Q}from"./orders-CVPzGqza.js";import{_ as J,n as K,a as W,F as b}from"./FormItem-h7aUKUCq.js";import{T as I}from"./TextButton-r7pYWVFz.js";import{_ as S}from"./Input.vue_vue_type_script_setup_true_lang-C-ZhocfE.js";import{D as _}from"./Divider-Dq0HTROm.js";import{u as T}from"./index-GdYk5yA4.js";import{p as B,a as j,d as X}from"./checkoutConfig-DcQSMzml.js";import{u as Y}from"./index-CJiuavPj.js";const Z={class:"radio"},ee=["name","id","value","disabled","checked"],te=["for"],D=k({__name:"Radio",props:{modelValue:{},options:{},onChange:{type:Function,default:void 0}},emits:["update:modelValue"],setup(v,{emit:o}){const l=v,f=o,m=String(Math.random()).slice(2),n=$({get(){return l.modelValue},set(t){f("update:modelValue",t)}});return(t,c)=>(p(),x("div",Z,[(p(!0),x(N,null,R(t.options,d=>(p(),x("div",{key:d.value,class:"my-2"},[q(e("input",{"onUpdate:modelValue":c[0]||(c[0]=g=>n.value=g),type:"radio",name:i(m),id:`${String(d.value)}-${i(m)}`,value:d.value,disabled:d==null?void 0:d.disabled,checked:d.value===n.value,onChange:c[1]||(c[1]=g=>{var h;return(h=t.onChange)==null?void 0:h.call(t,n.value)})},null,40,ee),[[L,n.value]]),e("label",{for:`${String(d.value)}-${i(m)}`,class:"h-full ml-2 [&>*]:pointer-events-none"},[A(t.$slots,"option",E({ref_for:!0},d),()=>[C(u(d.label),1)])],8,te)]))),128))]))}}),se={class:"w-full px-4 py-2 rounded-xl shadow-md flex flex-col gap-4 sm:flex-row sm:justify-between sm:items-end"},ae={class:"sm:w-1/2 flex gap-3"},oe=["src"],le={class:"flex flex-col gap-2"},re=["textContent"],ne=["textContent"],de={class:"sm:w-1/2 flex justify-between items-baseline"},ue={class:"text-xs sm:text-md text-primary-dark"},ie=["textContent"],me=["textContent"],pe={class:"text-xs sm:text-md text-primary-dark"},ce=["textContent"],fe=k({__name:"CheckoutCartItem",props:{cartItem:{}},setup(v){return(o,l)=>(p(),x("div",se,[e("div",ae,[e("img",{src:o.cartItem.product.image,alt:"",class:"w-16 h-16 object-cover aspect-square rounded overflow-hidden"},null,8,oe),e("div",le,[e("p",{textContent:u(o.cartItem.product.title),class:"text-lg"},null,8,re),e("p",{textContent:u(o.cartItem.product.description),class:"text-xs"},null,8,ne)])]),e("div",de,[e("p",ue,[l[0]||(l[0]=C(" NT. ")),e("span",{textContent:u(o.cartItem.product.price),class:"text-lg sm:text-2xl"},null,8,ie)]),e("p",{textContent:u(`數量 : ${o.cartItem.quantity}`),class:"text-sm sm:text-xl"},null,8,me),e("p",pe,[l[1]||(l[1]=C(" NT. ")),e("span",{textContent:u(o.cartItem.product.price*o.cartItem.quantity),class:"text-lg sm:text-2xl"},null,8,ce)])])]))}}),he={class:"text-right pr-5"},xe={class:"text-right"},ve={class:"text-right"},ye={class:"text-right"},_e=k({__name:"CheckoutDetail",props:{deliveryFee:{}},setup(v){const o=v,l=U(),f=$(()=>o.deliveryFee+l.cartTotal);return(m,n)=>(p(),x("table",null,[e("tbody",null,[e("tr",null,[e("td",he,u(i(l).numItemsInCart)+"件商品，商品金額： ",1),e("td",xe,"$ "+u(i(l).cartTotal),1)]),e("tr",null,[n[0]||(n[0]=e("td",{class:"text-right pr-5"},"運費： ",-1)),e("td",ve,"$ "+u(m.deliveryFee),1)]),e("tr",null,[n[1]||(n[1]=e("td",{class:"text-right pr-5"},"應付金額： ",-1)),e("td",ye,"$ "+u(f.value),1)])])]))}}),ge={class:"w-full self-end flex justify-end gap-3"},Se=k({__name:"Checkout",setup(v){const o=z(),l=U(),f=Q(),m=M(),n=M(!1),t=w({payMethod:B[0].value,pickMethod:j[0].value,name:"",phone:""}),c=$(()=>X[t.pickMethod]),d=w({name:[{pattern:K,message:"請填寫取貨人資訊"}],phone:[{pattern:W,message:"取貨人手機號碼格式錯誤"}]});async function g(){if(n.value=!0,!m.value.validate()){n.value=!1;return}const{destroy:s}=T(),r=await f.createOrder({...t,deliveryFee:c.value});if(n.value=!1,r.status==="error"){Y({message:"建立訂單失敗",type:"error"}),s();return}const{id:O}=r.data.order;if(t.payMethod==="online"){const P=await f.checkout({id:O});document.body.insertAdjacentHTML("afterend",P.data.html),H(()=>{const V=document.getElementById("_form_aiochk");V&&V.submit()})}else o.push({name:"order",params:{id:r.data.order.id}});s()}return G(async()=>{if(l.cartItems.length)return;const{destroy:h}=T(),s=await l.getCart();h(),(s.status==="error"||!l.cartItems.length)&&o.push({name:"home"})}),(h,s)=>(p(),F(J,{ref_key:"ruleFormRef",ref:m,model:t,rules:d,onSubmit:g,class:"mx-auto flex flex-col items-center md:w-4/5"},{default:y(()=>[s[5]||(s[5]=e("h1",{textContent:"訂單詳情",class:"text-xl font-bold text-center"},null,-1)),a(_,{class:"my-5"}),a(b,{label:"選擇付款方式",prop:"payMethod"},{default:y(()=>[a(D,{modelValue:t.payMethod,"onUpdate:modelValue":s[0]||(s[0]=r=>t.payMethod=r),options:i(B)},null,8,["modelValue","options"])]),_:1}),a(_,{class:"mb-5"}),a(b,{label:"選擇取貨方式",prop:"pickMethod"},{default:y(()=>[a(D,{modelValue:t.pickMethod,"onUpdate:modelValue":s[1]||(s[1]=r=>t.pickMethod=r),options:i(j)},null,8,["modelValue","options"])]),_:1}),a(_,{class:"mb-5"}),a(b,{label:"取貨人姓名",prop:"name"},{default:y(()=>[a(S,{modelValue:t.name,"onUpdate:modelValue":s[2]||(s[2]=r=>t.name=r)},null,8,["modelValue"])]),_:1}),a(b,{label:"取貨人手機號碼",prop:"phone"},{default:y(()=>[a(S,{modelValue:t.phone,"onUpdate:modelValue":s[3]||(s[3]=r=>t.phone=r)},null,8,["modelValue"])]),_:1}),a(_,{class:"my-5"}),(p(!0),x(N,null,R(i(l).cartItems,r=>(p(),F(fe,{key:r.id,cartItem:r},null,8,["cartItem"]))),128)),a(_,{class:"my-5"}),a(_e,{class:"self-end",deliveryFee:c.value},null,8,["deliveryFee"]),e("div",ge,[a(I,{text:"返回購物車",class:"!w-72 my-4 border-black",onClick:s[4]||(s[4]=r=>i(o).push({name:"CartContent"}))}),a(I,{text:"結帳",type:"submit",disabled:n.value,class:"!w-72 my-4 bg-primary-dark"},null,8,["disabled"])])]),_:1},8,["model","rules"]))}});export{Se as default};
